<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ELECTRO | The Aesthetic Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = { theme: { extend: { fontFamily: { sans: ['Inter', 'sans-serif'] }, colors: { surface: '#030303', glass: 'rgba(20, 20, 20, 0.5)', borderGlass: 'rgba(255, 255, 255, 0.08)', accent: '#ffffff' } } } }
    </script>
    <style>
        body { background-color: #000; color: #f5f5f7; overflow-x: hidden; scroll-behavior: smooth; }
        
        /* Premium Cinematic Overlay */
        .noise-bg { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 9999; opacity: 0.03; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E"); }

        .glass-panel { background: var(--glass); backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px); border: 1px solid var(--borderGlass); box-shadow: 0 40px 80px rgba(0,0,0,0.8); }
        .nav-blur { background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(40px); border-bottom: 1px solid var(--borderGlass); }
        
        .track-mega { letter-spacing: 0.25em; } .font-hairline { font-weight: 100; }
        
        /* Ultra-Clean Inputs */
        input, select, textarea { background: transparent; border: none; border-bottom: 1px solid rgba(255,255,255,0.15); color: white; padding: 12px 0; outline: none; transition: all 0.4s ease; font-weight: 300; }
        input:focus, select:focus, textarea:focus { border-bottom-color: white; box-shadow: 0 1px 0 0 white; }
        
        .btn-sleek { transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        .btn-sleek:hover { transform: scale(1.02); background: #fff; color: #000; box-shadow: 0 0 30px rgba(255,255,255,0.2); }
        
        /* Interactive Card - Maintained as it was premium */
        .card-container { perspective: 1000px; width: 100%; max-width: 340px; margin: 0 auto; height: 190px; }
        .card-inner { width: 100%; height: 100%; transition: transform 0.8s cubic-bezier(0.16, 1, 0.3, 1); transform-style: preserve-3d; position: relative; }
        .card-container.flip .card-inner { transform: rotateY(180deg); }
        .card-front, .card-back { width: 100%; height: 100%; position: absolute; backface-visibility: hidden; border-radius: 1.2rem; background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.02) 100%); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; justify-content: space-between; padding: 1.5rem; }
        .card-back { transform: rotateY(180deg); }
        .card-stripe { width: calc(100% + 3rem); height: 40px; background: #000; margin-top: 1rem; margin-left: -1.5rem; }
        
        /* Drawers */
        .drawer { transform: translateX(100%); transition: transform 0.7s cubic-bezier(0.16, 1, 0.3, 1); }
        .drawer.open { transform: translateX(0); }
        #overlay { opacity: 0; pointer-events: none; transition: opacity 0.5s ease; }
        #overlay.open { opacity: 1; pointer-events: auto; }

        /* Minimalist Loading Spinner */
        .minimal-spinner { width: 40px; height: 40px; border: 1px solid rgba(255,255,255,0.1); border-top-color: #fff; border-radius: 50%; animation: spin 1s cubic-bezier(0.6, 0.2, 0.4, 0.8) infinite; margin: 0 auto; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Smooth UI Reveal */
        .reveal { opacity: 0; transform: translateY(30px); transition: all 1s cubic-bezier(0.16, 1, 0.3, 1); }
        .reveal.active { opacity: 1; transform: translateY(0); }
        .fade-in { animation: fadeIn 0.8s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        ::-webkit-scrollbar { width: 2px; } ::-webkit-scrollbar-track { background: transparent; } ::-webkit-scrollbar-thumb { background: #444; }
        
        .pay-tab { flex: 1; padding: 14px 0; text-align: center; border-radius: 8px; font-size: 10px; text-transform: uppercase; letter-spacing: 0.2em; cursor: pointer; transition: all 0.4s ease; border: 1px solid transparent; }
        .pay-tab.active { background: white; color: black; font-weight: 600; }
        .pay-tab.inactive { color: #666; } .pay-tab.inactive:hover { color: white; border-color: rgba(255,255,255,0.2); }
        
        /* Custom File Upload */
        input[type="file"] { display: none; } .custom-file-upload { display: flex; flex-direction: column; align-items: center; justify-content: center; border: 1px dashed var(--borderGlass); padding: 30px; cursor: pointer; border-radius: 16px; transition: all 0.3s; background: rgba(255,255,255,0.01); }
        .custom-file-upload:hover { border-color: #fff; background: rgba(255,255,255,0.03); }
    </style>
</head>
<body class="antialiased selection:bg-white selection:text-black">

    <div class="noise-bg"></div>
    <div id="overlay" class="fixed inset-0 bg-black/95 z-[100] backdrop-blur-md" onclick="closeAllDrawers()"></div>
    <div id="toast-container" class="fixed top-24 left-1/2 -translate-x-1/2 z-[500] flex flex-col gap-3 w-max pointer-events-none"></div>

    <div id="profile-drawer" class="drawer fixed top-0 right-0 h-full w-full md:w-[450px] bg-[#050505] border-l border-white/5 z-[150] flex flex-col">
        <div class="p-8 flex justify-between items-center">
            <h2 class="text-[10px] uppercase track-mega text-gray-500">Identity</h2>
            <button onclick="closeAllDrawers()" class="text-white text-2xl font-light hover:rotate-90 transition-transform">&times;</button>
        </div>
        <div class="px-8 pb-8 space-y-8 flex-grow overflow-y-auto">
            <div class="flex items-center gap-6 mb-4">
                <div class="w-14 h-14 rounded-full border border-white/20 flex items-center justify-center text-xl font-light" id="profile-avatar">U</div>
                <div>
                    <h3 class="text-lg font-light" id="profile-display-name">User</h3>
                    <span class="text-[9px] uppercase track-mega text-gray-500">Verified Member</span>
                </div>
            </div>
            
            <form id="profile-form" onsubmit="saveProfile(event)" class="space-y-6">
                <div><input type="text" id="prof-name" class="w-full text-sm" placeholder="Full Legal Name" required></div>
                <div><input type="tel" id="prof-phone" class="w-full text-sm font-mono tracking-wider" maxlength="10" placeholder="Phone Number (10 Digits)" required></div>
                <div><textarea id="prof-address" class="w-full text-sm resize-none" rows="2" placeholder="Primary Delivery Address" required></textarea></div>
                <button type="submit" class="w-full border border-white hover:bg-white hover:text-black transition-colors text-white py-4 rounded-full text-[10px] uppercase track-mega font-medium mt-4">Save Identity</button>
            </form>
            <button onclick="logout()" class="w-full text-gray-500 hover:text-white py-4 text-[10px] uppercase track-mega transition-colors border-t border-white/10 mt-8">Sign Out</button>
        </div>
    </div>

    <div id="cart-drawer" class="drawer fixed top-0 right-0 h-full w-full md:w-[450px] bg-[#050505] border-l border-white/5 z-[150] flex flex-col">
        <div class="p-8 flex justify-between items-center border-b border-white/5">
            <h2 class="text-[10px] uppercase track-mega text-gray-500">Shopping Bag</h2>
            <button onclick="closeAllDrawers()" class="text-white text-2xl font-light hover:rotate-90 transition-transform">&times;</button>
        </div>
        <div id="cart-items" class="flex-grow overflow-y-auto p-8 space-y-8"></div>
        <div class="p-8 bg-[#020202] border-t border-white/5">
            <div id="checkout-details" class="hidden mb-8 space-y-4 fade-in">
                <div class="flex justify-between items-end mb-4">
                    <h3 class="text-[10px] uppercase track-mega text-gray-500">Delivery Details</h3>
                    <button type="button" onclick="fillFromProfile()" class="text-[9px] uppercase track-mega text-white border-b border-white/30 hover:border-white transition pb-0.5">Auto-fill</button>
                </div>
                <input type="text" id="cust-name" placeholder="Recipient Name" required class="w-full text-sm font-light">
                <input type="text" id="cust-address" placeholder="Complete Delivery Address" required class="w-full text-sm font-light">
                <input type="tel" id="cust-phone" placeholder="Phone Number" required class="w-full text-sm font-mono tracking-wider" maxlength="10">
            </div>
            <div class="flex justify-between items-end mb-8">
                <span class="text-[10px] uppercase track-mega text-gray-500">Total</span>
                <span id="cart-total" class="text-3xl font-light tracking-tight">₹0</span>
            </div>
            <button id="checkout-init-btn" onclick="openCheckoutDetails()" class="w-full bg-white text-black py-5 rounded-full text-[10px] uppercase track-mega font-bold btn-sleek shadow-[0_0_20px_rgba(255,255,255,0.1)]">Proceed to Checkout</button>
        </div>
    </div>

    <div id="modal-payment" class="fixed inset-0 z-[300] hidden items-center justify-center p-4 bg-black/80 backdrop-blur-xl">
        <div class="glass-panel p-8 md:p-12 w-full max-w-[480px] rounded-[2rem] relative flex flex-col">
            <button onclick="closeModal('modal-payment')" class="absolute top-6 right-6 text-gray-500 hover:text-white transition z-20 text-2xl font-light">&times;</button>
            
            <div id="payment-input-step" class="fade-in">
                <div class="text-center mb-10">
                    <p class="text-[9px] track-mega uppercase text-gray-400 mb-2">Encrypted Gateway</p>
                    <h2 class="text-3xl font-light text-white">Select Method</h2>
                </div>

                <div class="flex gap-4 mb-10 bg-white/5 p-1 rounded-xl">
                    <div id="tab-upi" onclick="switchPayMethod('upi')" class="pay-tab active">Direct UPI</div>
                    <div id="tab-card" onclick="switchPayMethod('card')" class="pay-tab inactive">Credit Card</div>
                </div>

                <div id="form-upi" class="flex flex-col items-center">
                    <div class="w-16 h-16 rounded-full bg-white/5 border border-white/10 flex items-center justify-center mb-6 shadow-xl">
                        <i class="fa-solid fa-mobile-screen-button text-2xl text-white"></i>
                    </div>
                    <p class="text-sm font-light text-center mb-2">Fast & Secure Mobile Payment</p>
                    <p class="text-[10px] text-gray-500 uppercase track-mega text-center mb-8">Opens directly in GPay, PhonePe, or Paytm</p>
                    
                    <button onclick="triggerUPIApp()" class="w-full border border-white text-white py-5 rounded-full text-[10px] uppercase track-mega font-bold hover:bg-white hover:text-black transition-all flex justify-center items-center gap-3">
                        Pay <span id="pay-amt-upi" class="font-mono">₹0</span> via App <i class="fa-solid fa-arrow-right"></i>
                    </button>
                </div>

                <div id="form-card" class="hidden flex-col">
                    <div class="card-container mb-10" id="card-3d">
                        <div class="card-inner">
                            <div class="card-front">
                                <div class="flex justify-between items-start">
                                    <i class="fa-solid fa-microchip text-3xl text-white/50"></i>
                                    <p class="text-[10px] uppercase track-mega text-white/50 font-bold">Bank</p>
                                </div>
                                <div>
                                    <div id="vis-num" class="font-mono text-xl tracking-widest mb-4 text-white drop-shadow-md">XXXX XXXX XXXX XXXX</div>
                                    <div class="flex justify-between items-end">
                                        <div class="truncate pr-4">
                                            <p class="text-[7px] uppercase text-white/50 track-mega mb-1">Cardholder</p>
                                            <p id="vis-name" class="font-mono text-xs uppercase text-white truncate">NAME</p>
                                        </div>
                                        <div class="text-right shrink-0">
                                            <p class="text-[7px] uppercase text-white/50 track-mega mb-1">Expires</p>
                                            <p id="vis-exp" class="font-mono text-xs text-white">MM/YY</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-back">
                                <div class="card-stripe"></div>
                                <div class="mt-6 flex flex-col items-end">
                                    <p class="text-[7px] uppercase text-white/50 track-mega mb-1">CVV</p>
                                    <div class="bg-white/20 text-white font-mono px-3 py-1.5 text-sm rounded w-16 text-center backdrop-blur-md" id="vis-cvv">***</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6 mb-8">
                        <input type="text" id="card-num" placeholder="Card Number" maxlength="16" oninput="this.value = this.value.replace(/[^0-9]/g, ''); updateCardVisual()" onfocus="flipCard(false)" class="w-full text-sm font-mono tracking-widest">
                        <input type="text" id="card-name" placeholder="Name on Card" class="w-full text-sm uppercase font-light" oninput="updateCardVisual()" onfocus="flipCard(false)">
                        <div class="flex gap-6">
                            <input type="text" id="card-exp" placeholder="Expiry (MM/YY)" maxlength="5" oninput="formatExpiry(this); updateCardVisual()" onfocus="flipCard(false)" class="w-full text-sm font-mono">
                            <input type="password" id="card-cvv" placeholder="CVV" maxlength="3" oninput="this.value = this.value.replace(/[^0-9]/g, ''); updateCardVisual()" onfocus="flipCard(true)" onblur="flipCard(false)" class="w-full text-sm font-mono text-center tracking-widest">
                        </div>
                    </div>

                    <button onclick="processCardPayment()" class="w-full bg-white text-black py-5 rounded-full text-[10px] uppercase track-mega font-bold hover:bg-gray-200 transition-all shadow-[0_0_20px_rgba(255,255,255,0.2)]">
                        Pay <span id="pay-amt-card" class="font-mono">₹0</span> Securely
                    </button>
                </div>
            </div>

            <div id="payment-processing-step" class="hidden flex-col items-center justify-center py-16 text-center fade-in">
                <div class="minimal-spinner mb-8"></div>
                <h3 class="text-xl font-light mb-3 text-white" id="process-title">Authenticating...</h3>
                <p class="text-[10px] text-gray-500 uppercase track-mega" id="process-desc">Establishing secure connection</p>
            </div>

            <div id="payment-success-step" class="hidden flex-col items-center justify-center py-12 text-center fade-in">
                <div class="w-20 h-20 rounded-full border border-white/20 bg-white/5 flex items-center justify-center mb-8 shadow-[0_0_40px_rgba(255,255,255,0.1)]">
                    <i class="fa-solid fa-check text-3xl text-white"></i>
                </div>
                <h3 class="text-3xl font-light mb-3 tracking-tight">Payment Approved</h3>
                <p class="text-[10px] text-gray-400 uppercase track-mega font-mono mb-10" id="success-txn">TXN: #00000000</p>
                <button onclick="finishOrder()" class="border border-white/20 text-gray-300 px-10 py-4 rounded-full text-[10px] uppercase track-mega hover:bg-white hover:text-black hover:border-white transition-all">View Order in Store</button>
            </div>
        </div>
    </div>

    <nav class="nav-blur fixed top-0 w-full z-50">
        <div class="w-full max-w-[1600px] mx-auto px-6 md:px-12 flex justify-between items-center h-[80px]">
            <div class="text-2xl font-hairline track-mega cursor-pointer" onclick="navigate('home')">ELECTR<span class="font-medium">O</span></div>
            <div class="flex items-center gap-10">
                <div id="auth-section" class="text-[10px] uppercase track-mega flex items-center gap-8 text-gray-400 font-medium"></div>
                <div class="flex gap-6 border-l border-white/10 pl-6">
                    <button onclick="openProfile()" class="text-gray-400 hover:text-white transition" id="nav-profile-btn" style="display:none;"><i class="fa-regular fa-user text-lg"></i></button>
                    <button onclick="openCart()" class="relative text-gray-400 hover:text-white transition">
                        <i class="fa-solid fa-bag-shopping text-lg"></i>
                        <span id="nav-cart-count" class="absolute -top-2 -right-2 bg-white text-black text-[9px] h-4 w-4 rounded-full flex items-center justify-center font-bold">0</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div id="modal-product" class="fixed inset-0 z-[250] hidden items-center justify-center p-4 bg-black/90 backdrop-blur-md">
        <div class="glass-panel p-10 w-full max-w-lg rounded-3xl relative">
            <button onclick="closeModal('modal-product')" class="absolute top-6 right-6 text-gray-500 hover:text-white text-2xl font-light">&times;</button>
            <h2 class="text-[10px] uppercase track-mega text-gray-400 mb-8 text-center" id="admin-modal-title">Inventory Setup</h2>
            <form onsubmit="saveProduct(event)" class="space-y-6">
                <input type="hidden" id="p-id"> <input type="hidden" id="p-img-data">
                <label class="custom-file-upload">
                    <input type="file" accept="image/*" onchange="handleImageUpload(event, 'p-img-data', 'p-preview', 'p-icon', 'p-text')">
                    <img id="p-preview" class="hidden w-32 h-32 object-cover rounded-xl mb-4 border border-white/10">
                    <i id="p-icon" class="fa-solid fa-camera text-2xl text-gray-500 mb-3"></i>
                    <span id="p-text" class="text-[9px] uppercase track-mega text-gray-500">Upload Image</span>
                </label>
                <input type="text" id="p-name" placeholder="Product Name" required class="text-sm w-full">
                <div class="flex gap-6">
                    <select id="p-cat" class="w-full text-sm text-gray-400" required></select>
                    <input type="number" id="p-price" placeholder="Price (₹)" required class="text-sm w-full">
                </div>
                <input type="number" id="p-stock" placeholder="Stock" required class="text-sm w-full">
                <button type="submit" class="w-full bg-white text-black py-4 rounded-full text-[10px] uppercase track-mega font-bold mt-4 hover:bg-gray-200 transition">Save Product</button>
            </form>
        </div>
    </div>

    <main class="min-h-screen flex flex-col pt-[80px]">
        
        <section id="view-home" class="view-section flex-grow">
            <div id="ad-slider-container" class="relative w-full h-[70vh] md:h-[85vh] flex items-center justify-center overflow-hidden bg-[#020202]">
                <div class="absolute w-[600px] h-[600px] bg-white/5 blur-[120px] rounded-full pointer-events-none z-0"></div>
                <div id="ad-slides" class="w-full h-full relative z-10"></div>
            </div>
            
            <div id="store" class="w-full max-w-[1600px] mx-auto px-6 md:px-12 py-24">
                <div class="flex flex-col md:flex-row justify-between items-center mb-16 gap-8 border-b border-white/5 pb-8 reveal">
                    <h2 class="text-2xl font-light track-mega uppercase">Collection</h2>
                    <div class="flex flex-wrap justify-center gap-6" id="category-tabs"></div>
                </div>
                <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-x-8 gap-y-16"></div>
            </div>
        </section>

        <section id="view-login" class="view-section hidden flex-grow flex items-center justify-center px-4 bg-[#030303]">
            <div class="glass-panel p-12 w-full max-w-md rounded-[2.5rem] text-center reveal active">
                <div class="w-16 h-16 rounded-full bg-white/5 border border-white/10 mx-auto flex items-center justify-center mb-8">
                    <i class="fa-regular fa-user text-2xl text-white"></i>
                </div>
                <h2 class="text-2xl font-light tracking-tight mb-2">Portal Access</h2>
                <p class="text-[10px] uppercase track-mega text-gray-500 mb-10">Sign in to continue</p>
                <form onsubmit="handleAuth(event)" class="space-y-6 text-left">
                    <input type="text" id="login-username" required placeholder="Username" class="w-full text-sm">
                    <input type="password" id="login-password" required placeholder="Password" class="w-full text-sm">
                    <button type="submit" class="w-full border border-white hover:bg-white hover:text-black transition-colors text-white py-4 rounded-full text-[10px] uppercase track-mega font-bold mt-8">Authenticate</button>
                </form>
            </div>
        </section>

        <section id="view-admin" class="view-section hidden flex-grow w-full max-w-[1600px] mx-auto px-6 md:px-12 py-16">
            <div class="flex flex-col md:flex-row justify-between items-end mb-16 border-b border-white/5 pb-8 gap-6 reveal active">
                <div>
                    <span class="text-[10px] text-gray-500 uppercase track-mega block mb-3">Workspace</span>
                    <h2 class="text-4xl font-hairline uppercase tracking-tight">Command Center</h2>
                </div>
                <div class="flex gap-4">
                    <button onclick="openModal('modal-product')" class="bg-white text-black px-8 py-4 rounded-full text-[10px] font-bold uppercase track-mega hover:bg-gray-200 transition">Add Product</button>
                    <button onclick="logout()" class="text-red-500 text-[10px] font-bold uppercase track-mega px-6">Exit</button>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 reveal active">
                <div class="lg:col-span-5">
                    <h3 class="text-[10px] font-bold uppercase track-mega text-gray-500 mb-6 flex items-center gap-3"><span class="w-2 h-2 bg-green-500 rounded-full animate-pulse shadow-[0_0_10px_rgba(74,222,128,0.8)]"></span> Confirmed Orders</h3>
                    <div id="admin-orders" class="space-y-4"></div>
                    <div id="no-orders" class="glass-panel p-10 text-center rounded-3xl text-gray-600 text-[10px] uppercase track-mega hidden">No orders yet.</div>
                </div>
                <div class="lg:col-span-7">
                    <h3 class="text-[10px] font-bold uppercase track-mega text-gray-500 mb-6">Inventory Status</h3>
                    <div id="admin-inventory" class="glass-panel rounded-3xl divide-y divide-white/5"></div>
                </div>
            </div>
        </section>
    </main>

    <footer class="border-t border-white/5 bg-[#020202]">
        <div class="max-w-[1600px] mx-auto px-6 md:px-12 py-16 flex flex-col md:flex-row justify-between items-center gap-8">
            <div class="text-xl font-hairline track-mega text-gray-500">ELECTR<span class="font-medium text-white">O</span></div>
            <p class="text-[9px] uppercase track-mega text-gray-600">&copy; 2026 Electro. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        // INIT STATE (LocalStorage maintained)
        let defaultProducts = [
            { id: '1', name: 'Aura Studio Master', cat: 'Audio', price: 45000, img: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=800', stock: 10 },
            { id: '2', name: 'Pro Display XDR', cat: 'Vision', price: 189000, img: 'https://images.unsplash.com/photo-1527443224154-c4a3942d3acf?w=800', stock: 4 },
            { id: '3', name: 'Titanium Timepiece', cat: 'Lifestyle', price: 72500, img: 'https://images.unsplash.com/photo-1546868871-7041f2a55e12?w=800', stock: 20 },
            { id: '4', name: 'Tactile Engine Key', cat: 'Lifestyle', price: 18000, img: 'https://images.unsplash.com/photo-1595225476474-87563907a212?w=800', stock: 0 }
        ];
        let defaultAds = [{ id: 'ad1', title: 'PURE <span class="font-medium">VISION.</span>', subtitle: 'The aesthetic of future tech', img: 'https://images.unsplash.com/photo-1593640408182-31c70c8268f5?q=80&w=2000' }];

        let state = {
            user: JSON.parse(localStorage.getItem('el_user')) || null,
            cart: JSON.parse(localStorage.getItem('el_cart')) || [],
            orders: JSON.parse(localStorage.getItem('el_orders')) || [],
            products: JSON.parse(localStorage.getItem('el_products')) || defaultProducts,
            ads: defaultAds,
            categories: ['Audio', 'Vision', 'Lifestyle'],
            currentFilter: 'All'
        };

        function saveState() {
            localStorage.setItem('el_user', JSON.stringify(state.user));
            localStorage.setItem('el_cart', JSON.stringify(state.cart));
            localStorage.setItem('el_orders', JSON.stringify(state.orders));
            localStorage.setItem('el_products', JSON.stringify(state.products));
        }

        const inr = (n) => new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(n);
        
        // STRICT VALIDATIONS
        const isValidPhone = (p) => /^[6-9]\d{9}$/.test(p);
        const isValidName = (n) => /^[A-Za-z\s]{3,50}$/.test(n);
        const isValidAddress = (a) => a.trim().length >= 10;
        const isValidCardNum = (n) => n.length === 16;
        
        function showToast(msg, type = 'info') {
            const c = document.getElementById('toast-container'); const t = document.createElement('div');
            t.className = `glass-panel px-8 py-4 rounded-full fade-in-up text-[10px] uppercase track-mega font-bold text-white shadow-2xl`;
            t.innerText = msg; c.appendChild(t);
            setTimeout(() => { t.style.opacity = '0'; t.style.transform = 'translateY(10px)'; setTimeout(() => t.remove(), 400); }, 3000);
        }

        // DRAWERS & UI
        function openCart() { document.getElementById('cart-drawer').classList.add('open'); document.getElementById('overlay').classList.add('open'); renderCart(); }
        function openProfile() { 
            document.getElementById('profile-drawer').classList.add('open'); document.getElementById('overlay').classList.add('open'); 
            if(state.user) {
                document.getElementById('profile-display-name').innerText = state.user.name || state.user.username;
                document.getElementById('profile-avatar').innerText = (state.user.name || state.user.username).charAt(0).toUpperCase();
                document.getElementById('prof-name').value = state.user.name || ''; document.getElementById('prof-phone').value = state.user.phone || ''; document.getElementById('prof-address').value = state.user.address || '';
            }
        }
        function closeAllDrawers() { 
            document.querySelectorAll('.drawer').forEach(d => d.classList.remove('open'));
            document.getElementById('overlay').classList.remove('open'); 
            document.getElementById('checkout-details').classList.add('hidden');
            document.getElementById('checkout-init-btn').innerText = 'Proceed to Checkout'; document.getElementById('checkout-init-btn').onclick = openCheckoutDetails;
        }

        function saveProfile(e) {
            e.preventDefault();
            const n = document.getElementById('prof-name').value.trim(); const p = document.getElementById('prof-phone').value.trim(); const a = document.getElementById('prof-address').value.trim();
            if(!isValidName(n)) return showToast('Name must contain only letters', 'error');
            if(!isValidPhone(p)) return showToast('Enter exactly 10 digits', 'error');
            if(!isValidAddress(a)) return showToast('Address must be descriptive', 'error');
            state.user.name = n; state.user.phone = p; state.user.address = a; saveState(); showToast('Identity Saved'); openProfile();
        }
        function fillFromProfile() {
            if(!state.user || !state.user.phone) return showToast('No saved data found', 'error');
            document.getElementById('cust-name').value = state.user.name; document.getElementById('cust-address').value = state.user.address; document.getElementById('cust-phone').value = state.user.phone;
        }

        // AUTHENTICATION
        function handleAuth(e) {
            e.preventDefault(); const u = document.getElementById('login-username').value.trim(); const p = document.getElementById('login-password').value;
            if (u === 'admin' && p === '20190126550') { state.user = { username: 'Admin', role: 'admin' }; navigate('admin'); } 
            else { 
                if(!/^[A-Za-z0-9_]+$/.test(u)) return showToast('Letters and numbers only', 'error');
                if(p.length < 5) return showToast('Password too weak', 'error');
                state.user = { username: u, role: 'user' }; navigate('home'); 
                if(state.cart.length > 0) setTimeout(() => openCart(), 500);
            }
            document.getElementById('nav-profile-btn').style.display = state.user.role === 'admin' ? 'none' : 'block';
            updateNavbar(); saveState(); showToast('Access Granted'); e.target.reset();
        }
        function logout() { state.user = null; saveState(); closeAllDrawers(); navigate('home'); updateNavbar(); }

        // NAVIGATION
        function navigate(view) {
            if (view === 'admin' && state.user?.role !== 'admin') return;
            document.querySelectorAll('.view-section').forEach(s => s.classList.add('hidden')); document.getElementById(`view-${view}`).classList.remove('hidden');
            if (view === 'home') { renderCategories(); renderHome(); initAds(); setTimeout(runReveal, 100); }
            if (view === 'admin') renderAdmin(); window.scrollTo(0,0);
        }
        function updateNavbar() {
            const auth = document.getElementById('auth-section'); const profBtn = document.getElementById('nav-profile-btn');
            if (!state.user) { auth.innerHTML = `<button onclick="navigate('login')" class="hover:text-white transition pb-1">Sign In</button>`; profBtn.style.display='none'; } 
            else {
                let adminBtn = state.user.role === 'admin' ? `<button onclick="navigate('admin')" class="text-white">Admin</button>` : '';
                auth.innerHTML = `${adminBtn} <span class="hidden md:inline font-light">${state.user.name || state.user.username}</span>`;
                profBtn.style.display = state.user.role === 'user' ? 'block' : 'none';
            }
            updateCartCount();
        }

        // 3D CARD ANIMATION
        function flipCard(back) { const c = document.getElementById('card-3d'); if(back) c.classList.add('flip'); else c.classList.remove('flip'); }
        function updateCardVisual() {
            let num = document.getElementById('card-num').value; let name = document.getElementById('card-name').value; let exp = document.getElementById('card-exp').value; let cvv = document.getElementById('card-cvv').value;
            document.getElementById('vis-num').innerText = num.padEnd(16, 'X').match(/.{1,4}/g).join(' '); document.getElementById('vis-name').innerText = name || 'NAME'; document.getElementById('vis-exp').innerText = exp || 'MM/YY'; document.getElementById('vis-cvv').innerText = cvv || '***';
        }
        function formatExpiry(input) { let val = input.value.replace(/\D/g, ''); if(val.length >= 2) val = val.substring(0,2) + '/' + val.substring(2,4); input.value = val; }

        // CART LOGIC
        function addToCart(id) {
            const p = state.products.find(x => x.id === id); if (p.stock <= 0) return;
            const exists = state.cart.find(x => x.id === id);
            if (exists) { if(exists.qty < p.stock) exists.qty++; else return showToast('Limit Reached'); } 
            else { state.cart.push({...p, qty: 1}); }
            saveState(); updateCartCount(); openCart();
        }
        function updateCartCount() { document.getElementById('nav-cart-count').innerText = state.cart.reduce((a,b) => a + b.qty, 0); }
        function renderCart() {
            const container = document.getElementById('cart-items');
            if(state.cart.length === 0) { container.innerHTML = `<div class="h-full flex flex-col justify-center items-center text-gray-500 text-[10px] uppercase track-mega">Bag is empty</div>`; document.getElementById('checkout-init-btn').style.display = 'none'; } 
            else {
                document.getElementById('checkout-init-btn').style.display = 'block';
                container.innerHTML = state.cart.map(i => `
                    <div class="flex items-center gap-6 pb-6 border-b border-white/5">
                        <img src="${i.img}" class="w-16 h-16 object-cover bg-white/5 rounded-xl shrink-0">
                        <div class="flex-grow">
                            <h4 class="font-medium text-sm">${i.name}</h4>
                            <p class="text-xs text-gray-500 mt-1 mb-2">Qty: ${i.qty} | ${inr(i.price)}</p>
                            <button onclick="removeFromCart('${i.id}')" class="text-[9px] uppercase track-mega text-red-500 hover:text-red-400">Remove</button>
                        </div>
                    </div>`).join('');
            }
            document.getElementById('cart-total').innerText = inr(state.cart.reduce((a,b) => a + (b.price * b.qty), 0));
        }
        function removeFromCart(id) { state.cart = state.cart.filter(x => x.id !== id); saveState(); renderCart(); updateCartCount(); }

        // CHECKOUT & AUTO-VERIFICATION FLOW
        function openCheckoutDetails() {
            if(!state.user) { closeAllDrawers(); showToast('Please Login First'); navigate('login'); return; }
            const form = document.getElementById('checkout-details');
            if(form.classList.contains('hidden')) { form.classList.remove('hidden'); document.getElementById('checkout-init-btn').innerText = 'Proceed to Payment'; document.getElementById('checkout-init-btn').onclick = openPaymentModal; }
        }

        function switchPayMethod(method) {
            document.getElementById('tab-upi').className = method === 'upi' ? 'pay-tab active' : 'pay-tab inactive';
            document.getElementById('tab-card').className = method === 'card' ? 'pay-tab active' : 'pay-tab inactive';
            document.getElementById('form-upi').classList.toggle('hidden', method !== 'upi');
            document.getElementById('form-card').classList.toggle('hidden', method !== 'card');
        }

        function openPaymentModal() {
            const name = document.getElementById('cust-name').value.trim(); const addr = document.getElementById('cust-address').value.trim(); const phone = document.getElementById('cust-phone').value.trim();
            if(!isValidName(name)) return showToast('Invalid Name', 'error'); if(!isValidPhone(phone)) return showToast('Enter 10 digit Phone', 'error'); if(!isValidAddress(addr)) return showToast('Address too short', 'error');
            
            closeAllDrawers(); switchPayMethod('upi');
            document.getElementById('card-name').value = name; document.getElementById('card-num').value = ''; document.getElementById('card-exp').value = ''; document.getElementById('card-cvv').value = ''; updateCardVisual();
            
            const totalAmt = state.cart.reduce((a,b) => a + (b.price * b.qty), 0);
            document.getElementById('pay-amt-upi').innerText = inr(totalAmt); document.getElementById('pay-amt-card').innerText = inr(totalAmt); document.getElementById('pay-amount-display').innerText = inr(totalAmt);

            document.getElementById('payment-input-step').classList.remove('hidden'); document.getElementById('payment-processing-step').classList.add('hidden'); document.getElementById('payment-success-step').classList.add('hidden');
            document.getElementById('modal-payment').classList.remove('hidden'); document.getElementById('modal-payment').classList.add('flex');
        }

        // UPI INTENT (DIRECT APP, NO UTR)
        function triggerUPIApp() {
            const totalAmt = state.cart.reduce((a,b) => a + (b.price * b.qty), 0);
            // This normally triggers GPay/PhonePe on Mobile
            const upiString = `upi://pay?pa=electrostore@ybl&pn=ElectroStore&am=${totalAmt}&cu=INR`;
            window.location.href = upiString; 
            
            // Auto Verify Simulation (Replacing UTR crap)
            document.getElementById('payment-input-step').classList.add('hidden');
            document.getElementById('payment-processing-step').classList.remove('hidden');
            document.getElementById('payment-processing-step').classList.add('flex');
            document.getElementById('process-title').innerText = "Awaiting App Response";
            document.getElementById('process-desc').innerText = "Do not close this window";

            setTimeout(() => { finalizeOrder('UPI_Verified'); }, 5000); // Auto confirms after 5 seconds
        }

        // CARD PROCESSING (AUTO VERIFY)
        function processCardPayment() {
            const num = document.getElementById('card-num').value; const exp = document.getElementById('card-exp').value; const cvv = document.getElementById('card-cvv').value;
            if (!document.getElementById('card-name').value.trim() || !isValidCardNum(num) || exp.length !== 5 || cvv.length < 3) return showToast('Invalid Card Details', 'error');

            document.getElementById('payment-input-step').classList.add('hidden');
            document.getElementById('payment-processing-step').classList.remove('hidden');
            document.getElementById('payment-processing-step').classList.add('flex');
            document.getElementById('process-title').innerText = "Authenticating Card";
            document.getElementById('process-desc').innerText = "Connecting with bank servers...";

            setTimeout(() => { finalizeOrder('Card_Verified'); }, 3000);
        }

        // UNIVERSAL ORDER FINALIZER (INSTANT SUCCESS, NO ADMIN REVIEW)
        function finalizeOrder(method) {
            // Deduct Stock immediately
            state.cart.forEach(c => { const p = state.products.find(x => x.id === c.id); if(p) p.stock -= c.qty; });
            const txnId = 'TXN-' + Math.floor(1000000 + Math.random()*9000000);
            
            state.orders.unshift({
                id: 'ORD-' + Math.floor(10000 + Math.random()*90000),
                customer: document.getElementById('cust-name').value, phone: document.getElementById('cust-phone').value,
                items: [...state.cart], total: state.cart.reduce((a,b) => a + (b.price * b.qty), 0),
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}), payId: txnId
            });
            
            state.cart = []; saveState(); updateCartCount(); 
            
            document.getElementById('payment-processing-step').classList.remove('flex'); document.getElementById('payment-processing-step').classList.add('hidden');
            document.getElementById('success-txn').innerText = `TXN: #${txnId}`;
            document.getElementById('payment-success-step').classList.remove('hidden'); document.getElementById('payment-success-step').classList.add('flex');
            renderHome();
        }

        function finishOrder() { closeModal('modal-payment'); document.getElementById('store').scrollIntoView(); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); document.getElementById(id).classList.remove('flex'); }

        // STORE RENDERING
        function renderCategories() { document.getElementById('category-tabs').innerHTML = `<button onclick="filterCat('All')" class="pb-1 text-[10px] uppercase track-mega font-bold border-b-2 ${state.currentFilter === 'All' ? 'border-white text-white' : 'border-transparent text-gray-500 hover:text-white'} transition">All</button>` + state.categories.map(c => `<button onclick="filterCat('${c}')" class="pb-1 text-[10px] uppercase track-mega font-bold border-b-2 ${state.currentFilter === c ? 'border-white text-white' : 'border-transparent text-gray-500 hover:text-white'} transition">${c}</button>`).join(''); }
        function filterCat(c) { state.currentFilter = c; renderCategories(); renderHome(); }
        
        function renderHome() {
            const dp = state.currentFilter === 'All' ? state.products : state.products.filter(p => p.cat === state.currentFilter);
            document.getElementById('product-grid').innerHTML = dp.map((p,i) => `
                <div class="group flex flex-col reveal">
                    <div class="aspect-[4/5] mb-6 overflow-hidden bg-white/5 relative cursor-pointer rounded-[2rem]" onclick="addToCart('${p.id}'); event.stopPropagation();">
                        ${p.stock<=0?`<div class="absolute inset-0 z-10 flex items-center justify-center bg-black/50"><span class="text-white border border-white px-4 py-2 text-[10px] uppercase track-mega">Sold Out</span></div>`:''}
                        <img src="${p.img}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-1000 ${p.stock<=0?'grayscale':''}">
                        <div class="absolute bottom-6 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 transition z-20"><span class="bg-white text-black px-8 py-4 rounded-full text-[9px] uppercase track-mega font-bold shadow-2xl block whitespace-nowrap">Add to Bag</span></div>
                    </div>
                    <p class="text-[9px] text-gray-500 uppercase track-mega mb-2">${p.cat}</p>
                    <h3 class="font-light text-lg mb-2 truncate">${p.name}</h3>
                    <p class="text-sm font-semibold">${inr(p.price)}</p>
                </div>
            `).join('');
            setTimeout(runReveal, 50);
        }

        // ADMIN RENDERING
        function renderAdmin() {
            document.getElementById('admin-inventory').innerHTML = state.products.map(p => `
                <div class="flex justify-between p-6 hover:bg-white/[0.02] transition border-b border-white/5">
                    <div class="flex gap-4 items-center">
                        <img src="${p.img}" class="w-12 h-12 object-cover rounded bg-white/5">
                        <div><p class="text-sm font-medium">${p.name}</p><p class="text-[9px] text-gray-500 uppercase track-mega mt-1">${p.stock} in stock</p></div>
                    </div>
                    <div class="flex gap-4 items-center">
                        <button onclick="openModal('modal-product', '${p.id}')" class="text-[9px] uppercase track-mega text-gray-400 hover:text-white">Edit</button>
                    </div>
                </div>`).join('');
            
            const ordersDiv = document.getElementById('admin-orders');
            document.getElementById('no-orders').classList.toggle('hidden', state.orders.length > 0);
            ordersDiv.innerHTML = state.orders.map(o => `
                <div class="glass-panel p-6 rounded-3xl mb-4 border-l-2 border-green-500">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <span class="font-medium text-xs track-mega block mb-2">${o.id}</span>
                            <span class="bg-green-500/20 text-green-400 px-3 py-1 rounded-full border border-green-500/50 text-[9px] uppercase track-mega font-bold">Verified</span>
                        </div>
                        <span class="text-[9px] text-gray-500 uppercase track-mega">${o.time}</span>
                    </div>
                    <h4 class="font-light text-sm mb-1">${o.customer} <span class="text-gray-500 text-xs ml-2">(${o.phone})</span></h4>
                    <p class="text-[10px] text-gray-400 font-mono tracking-widest mb-4">TXN: ${o.payId}</p>
                    <div class="space-y-2 border-t border-white/10 pt-4 bg-black/30 -mx-6 -mb-6 p-6 rounded-b-3xl">
                        ${o.items.map(i => `<div class="flex justify-between text-[10px] uppercase track-mega text-gray-400"><span>${i.name} x${i.qty}</span><span class="text-white">${inr(i.price*i.qty)}</span></div>`).join('')}
                        <div class="flex justify-between items-center text-xs track-mega text-white font-bold pt-2 border-t border-white/5 mt-2"><span>TOTAL ${inr(o.total)}</span></div>
                    </div>
                </div>`).join('');
        }

        // ADMIN ACTIONS
        function handleImageUpload(e, dataId, previewId, iconId, textId) { const f = e.target.files[0]; if(f){ const r = new FileReader(); r.onload = function(evt) { document.getElementById(dataId).value = evt.target.result; document.getElementById(previewId).src = evt.target.result; document.getElementById(previewId).classList.remove('hidden'); document.getElementById(iconId).classList.add('hidden'); document.getElementById(textId).innerText = 'Change Image'; }; r.readAsDataURL(f); } }
        function openModal(id, dataId=null) { const m = document.getElementById(id); m.classList.remove('hidden'); m.classList.add('flex'); if(id==='modal-product'){ document.getElementById('p-cat').innerHTML = state.categories.map(c => `<option value="${c}">${c}</option>`).join(''); if(dataId){ const p = state.products.find(x=>x.id===dataId); document.getElementById('p-id').value=p.id; document.getElementById('p-name').value=p.name; document.getElementById('p-cat').value=p.cat; document.getElementById('p-price').value=p.price; document.getElementById('p-stock').value=p.stock; document.getElementById('p-img-data').value=p.img; document.getElementById('p-preview').src=p.img; document.getElementById('p-preview').classList.remove('hidden'); document.getElementById('p-icon').classList.add('hidden'); } else { document.getElementById('p-id').value=''; document.getElementById('p-name').value=''; document.getElementById('p-price').value=''; document.getElementById('p-stock').value=''; document.getElementById('p-preview').classList.add('hidden'); document.getElementById('p-icon').classList.remove('hidden'); } } }
        function saveProduct(e) { e.preventDefault(); const id = document.getElementById('p-id').value; const data = { id: id || 'P'+Date.now(), name: document.getElementById('p-name').value, cat: document.getElementById('p-cat').value, img: document.getElementById('p-img-data').value || 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=500', price: Number(document.getElementById('p-price').value), stock: Number(document.getElementById('p-stock').value) }; if(id) state.products = state.products.map(x=>x.id===id?data:x); else state.products.unshift(data); saveState(); closeModal('modal-product'); renderAdmin(); renderHome(); showToast('Saved'); }

        // BANNERS
        function initAds() { document.getElementById('ad-slides').innerHTML = `<div class="ad-slide w-full h-full flex flex-col items-center justify-center active"><img src="https://images.unsplash.com/photo-1593640408182-31c70c8268f5?q=80&w=2000" class="absolute inset-0 w-full h-full object-cover opacity-30 grayscale"><div class="relative z-10 text-center px-4"><h1 class="text-5xl md:text-8xl font-hairline tracking-tighter mb-6">PURE <span class="font-medium">VISION.</span></h1><p class="text-gray-400 text-xs md:text-sm track-mega uppercase mb-10">The aesthetic of future tech</p><button onclick="document.getElementById('store').scrollIntoView()" class="border border-white/20 hover:bg-white hover:text-black transition-colors px-10 py-4 rounded-full text-[10px] uppercase track-mega font-bold backdrop-blur-md">Explore Gallery</button></div></div>`; }
        function runReveal() { const reveals = document.querySelectorAll('.reveal'); const observer = new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('active'); } }); }, { threshold: 0.1 }); reveals.forEach(r => observer.observe(r)); }

        window.onload = () => { renderCategories(); renderHome(); initAds(); updateNavbar(); setTimeout(runReveal, 100); };
    </script>
</body>
</html>
